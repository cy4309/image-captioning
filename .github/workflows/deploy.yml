name: Deploy Frontend & Backend

on:
  push:
    branches:
      - main # åªæœ‰æ¨ä¸Š main æ‰æœƒè§¸ç™¼éƒ¨ç½²
  workflow_dispatch: # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ å–å¾—å°ˆæ¡ˆåŸå§‹ç¢¼
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ å®‰è£ Node.js ä»¥å»ºç½®å‰ç«¯
      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 3ï¸âƒ£ å‰ç«¯å®‰è£ä¾è³´ & Lint & Build
      - name: ğŸ“¦ Install frontend dependencies
        working-directory: ./frontend
        run: npm install

      - name: âœ… Run frontend lint
        working-directory: ./frontend
        run: npm run lint --if-present

      - name: ğŸ› ï¸ Build frontend
        working-directory: ./frontend
        run: npm run build

      # 4ï¸âƒ£ éƒ¨ç½² Vercelï¼ˆå‰ç«¯ï¼‰
      - name: â–² Deploy to Vercel
        run: |
          npm install -g vercel
          vercel deploy --prod --yes --token=${{ secrets.VERCEL_TOKEN }}
        env:
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

      # 5ï¸âƒ£ é€šçŸ¥ Render éƒ¨ç½²å¾Œç«¯
      - name: ğŸ”„ Trigger Render backend deploy
        run: |
          echo "Triggering Render deploy..."
          curl -s -o /dev/null -w "%{http_code}" -X POST "${{ secrets.RENDER_DEPLOY_HOOK }}"
