services:
  backend:
    build: ./backend
    container_name: ocr-backend
    ports:
      - "8000:8000"
    # expose:
    #   - "8000"  # âœ… å…§éƒ¨ä½¿ç”¨ï¼Œä¸å°å¤–é–‹æ”¾
    env_file:
      - ./backend/.env
    restart: always      # âœ… essential â†’ è‹¥ backend crashï¼Œè‡ªå‹•é‡å•Ÿ
    # healthcheck:         # â­ optional â†’ ç¢ºä¿ backend å•Ÿå‹•æˆåŠŸæ‰è¢«è¦–ç‚º healthyï¼Œå…ˆè¨»è§£å› ç‚ºå…è²»render, verceléƒ½ä¸æœƒè‡ªå‹•è®€åŸ·è¡Œ
    #   test: ["CMD", "curl", "-f", "http://ocr-backend:8000/health"]  # âœ… ç”¨ container DNS åç¨±ï¼ˆæœ€æ¨™æº– Docker å¯«æ³•ï¼‰
    #   interval: 10s      # æ¯ 10 ç§’åµæ¸¬ä¸€æ¬¡
    #   timeout: 5s        # è‹¥ 5 ç§’æ²’å›æ‡‰è¦–ç‚º unhealthy
    #   retries: 3         # é€£çºŒ 3 æ¬¡å¤±æ•—æ‰åˆ¤å®šç‚º unhealthy
    #   start_period: 10s  # å®¹å™¨å•Ÿå‹•å¾Œ 10 ç§’å…§ä¸è¨ˆå…¥æª¢æŸ¥

  frontend:
    build: ./frontend
    container_name: ocr-frontend
    command: ["npm", "run", "build"]
    volumes:
      - frontend_build:/app/dist

  nginx:
    build:
      context: .
      dockerfile: ./nginx/Dockerfile
    ports:
      - "8080:80" # å·¦é‚Šä¸»æ©Ÿçš„ portï¼Œå³é‚Šå®¹å™¨å…§ Nginx çš„ port
    depends_on:
      - backend
      - frontend
    # depends_on:
    #   backend:
    #     condition: service_healthy   # ğŸ”¥ advanced â†’ nginx æœƒç­‰ backend å¥åº·æ‰å•Ÿå‹•
    #   frontend:
    #     condition: service_completed_successfully
    restart: always   # âœ… essential â†’ nginx æ›æ‰æœƒè‡ªå‹•é‡å•Ÿ
    volumes:
      - frontend_build:/usr/share/nginx/html

# ğŸ‘‡ é€™æ®µæ˜¯å¿…é ˆçš„
volumes:
  frontend_build: